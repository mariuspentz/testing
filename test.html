<script runat="server">
  Platform.Load("Core", "1");
  try {
</script>
%%[
var @newslettersubscriber,@loyaltynewslettersubscriber,@directmail,@unsubscribefromall,@todaydate,@myNLSub,@myLoyaltyNLSub,@NLFinalUnsubReason,@LNLFinalUnsubReason,@NLotherReason,@LNLotherReason

set @regid = RequestParameter("regId")
set @subKey = _subscriberkey

set @formatdate=DateAdd(Now(), 6, "H")
set @todaydate=Replace(FormatDate(@formatdate,"yyyy-MM-ddT","hh:mm:ss"),' ','')

set @newslettersubscriber = "False"
set @loyaltynewslettersubscriber = "False"

set @ContactId=RequestParameter("Contact")
set @regCountry=RequestParameter("RegCountry")

  set @regDE = "ENT.Registration__c_Salesforce_7"

  set @ecomSubscriber = Lookup(@regDE,"NewsletterSubscriber__c", "Id", @regid)
  set @loyaltySubscriber = Lookup(@regDE,"LoyaltyNewsletterSubscriber__c", "Id", @regid)

  var @LNLdoiDate,@LNLdoiFlag
  SET @LNLdoiDate="" 
  SET @LNLdoiFlag=""

    IF @ecomSubscriber != 'False' THEN
      set @result=UpdateSingleSalesforceObject(
      "Registration__c",@registrationId,
      "NewsletterSubscriber__c",@newslettersubscriber,
      "NewsletterUnsubscribeDate__c",@todaydate,
      "NLDoubleOptIn__c",@NLdoiFlag   
      )
      set @nullresult1=UpdateSingleSalesforceObject('Registration__c', @regid, 'fieldsToNull', 'NewsletterSubscriptionDate__c')
      set @nullresult2=UpdateSingleSalesforceObject('Registration__c', @regid, 'fieldsToNull', 'NLDoubleOptInDate__c')
    ENDIF

    IF @loyaltySubscriber != 'False' THEN
      set @result=UpdateSingleSalesforceObject(
        "Registration__c",@registrationId,
        "LoyaltyNewsletterSubscriber__c",@loyaltynewslettersubscriber,
        "LoyaltyNewsletterUnsubscribeDate__c",@todaydate,
        "LoyaltyNLDoubleOptIn__c",@loyaltynewslettersubscriber
      )
      set @nullresult2=UpdateSingleSalesforceObject('Registration__c', @regid, 'fieldsToNull', 'LoyaltyNewsletterSubscriptionDate__c')
      set @nullresult2=UpdateSingleSalesforceObject('Registration__c', @regid, 'fieldsToNull', 'LoyaltyNLDoubleOptInDate__c')    
    ENDIF

]%%

%%[
//Pull multilanguage content
var @rows,@rowCount,@i,@row

set @regDE = "ENT.Registration__c_Salesforce_7"
set @lang = Lookup(@regDE,"PreferredLanguage__c", "Id", @regid)
IF EMPTY (@lang) THEN
set @lang = "en_EN"
ENDIF
set @rows = LookupRows("Translation_Page_Triumph","langg", @lang)

var @transHeader1,@transName,@transEmail,@transPreferredLanguage,@transLoyaltyID,@transDateOfBirth,@transUnsubscribeReason,@transHeader2,@transOption1,@transOption2,@transOption3,@transHeader3,@transOption10,@transOption10,@transHeader3,@transSubmit,@transThankyou,@transErrorMsg
   set @rowCount = rowcount(@rows)
 if @rowCount > 0 then
    for @i = 1 to @rowCount do
    
    set @row = row(@rows, @i) 
    set @transHeader1 = field(@row,"Header1")
    set @transEmail = field(@row,"Email")
    set @transHeader2 = field(@row,"Header2")
    set @transOption1 = field(@row,"Option1")
    set @transOption2 = field(@row,"Option2")
    set @transSubmit = field(@row,"Submit") 
    set @transThankyou = field(@row,"Thankyou")
    set @transErrorMsg = field(@row,"ErrorMsg")
    set @transOption11 = field(@row,"Option11")
    set @transReason1 = field(@row,"Reason1")
    set @transReason2 = field(@row,"Reason2")
    set @transReason3 = field(@row,"Reason3")
    set @transReason4 = field(@row,"Reason4")
    set @unsubTrans = field(@row,"unsubTrans")
    
    next @i

  endif 

]%%
<script runat="server">
      } catch(e) { 
        
        Variable.SetValue("@Error_desc","true");
        Variable.SetValue("@Error_desc_detail",Stringify(e.message)+Stringify(e.description));
        Write(Stringify(e));
      }
</script>
<h1>%%=v(@unsubTrans)=%%</h1>
